---
import Layout from '../layouts/Layout.astro';
import PocketBase from 'pocketbase';
import TimelineCard from '../components/TimelineCard.astro';

const pb = new PocketBase('http://127.0.0.1:8090');

const experiences = await pb.collection('timeline').getFullList({
    sort: '-created',
});

const groupedByYear = experiences.reduce((acc, exp) => {
    const year = exp.annee || 'Autre';
    if (!acc[year]) {
        acc[year] = [];
    }
    acc[year].push(exp);
    return acc;
}, {});

const sortedYears = Object.keys(groupedByYear).sort((a, b) => b.localeCompare(a));
---

<Layout title="Mon Parcours">
    <section class="py-12 sm:py-16 px-4 sm:px-6 md:px-12 lg:px-20">
        <div class="text-center mb-12 sm:mb-16">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-[#BF2A52] mb-4 sm:mb-6">
                Mon parcours
            </h1>
            <p class="text-base sm:text-lg text-gray-700 max-w-4xl mx-auto leading-relaxed px-4">
                De mes premières expériences académiques à mes engagements actuels, 
                j'ai eu l'opportunité de développer mes compétences, de relever des défis 
                et de participer à des projets qui ont façonné mon parcours et mon projet professionnel.
            </p>
        </div>

        <div class="max-w-6xl mx-auto relative">
            <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-1 bg-[#BF2A52] transform -translate-x-1/2 z-0"></div>

            <div class="relative z-10">
                {sortedYears.map((year, yearIndex) => (
                    <>
                        <div class="flex justify-center mb-6 sm:mb-8">
                            <div class="bg-[#BF2A52] text-white px-6 sm:px-8 py-2 sm:py-3 rounded-lg font-bold text-lg sm:text-xl z-10 relative">
                                {year}
                            </div>
                        </div>

                        {groupedByYear[year].map((exp) => (
                            <TimelineCard
                                titre={exp.titre}
                                descriptif={exp.descriptif}
                                badge={exp.badge}
                                datePeriode={exp.date_periode}
                                position={yearIndex % 2 === 0 ? 'gauche' : 'droite'}
                            />
                        ))}
                    </>
                ))}
            </div>
        </div>
    </section>
</Layout>
